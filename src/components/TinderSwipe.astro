---
import dilemmasData from '../data/dilemmas.json';

const dilemmas = dilemmasData.scenes;
const resultadosConfig = dilemmasData.resultados || {};
const title = dilemmasData.title || 'Decision Tinder';
const description = dilemmasData.description || 'Swipe left or right based on your preferences';

const dilemmasJSON = JSON.stringify(dilemmas);
const resultadosJSON = JSON.stringify(resultadosConfig);
const titleJSON = JSON.stringify(title);
const descriptionJSON = JSON.stringify(description);
---

<div data-tinder-root></div>

<script define:vars={{ dilemmasJSON, resultadosJSON, titleJSON, descriptionJSON }}>
  (() => {
    let dilemmas = [];
    let resultadosConfig = {};
    let title = 'Decision Tinder';
    let description = 'Swipe left or right based on your preferences';
    
    try {
      dilemmas = JSON.parse(dilemmasJSON);
    } catch (e) {
      console.error('Error parsing dilemmas:', e);
      dilemmas = [];
    }

    try {
      resultadosConfig = JSON.parse(resultadosJSON);
    } catch (e) {
      console.error('Error parsing resultados:', e);
      resultadosConfig = {};
    }

    try {
      title = JSON.parse(titleJSON);
    } catch (e) {
      console.error('Error parsing title:', e);
    }

    try {
      description = JSON.parse(descriptionJSON);
    } catch (e) {
      console.error('Error parsing description:', e);
    }

    const CONFIG = {
      SWIPE_THRESHOLD: 100,
      ROTATION_FACTOR: 0.15,
      ANIMATION_DURATION: 400
    };

    let state = {
      currentIndex: 0,
      choices: {},
      isAnimating: false,
      showResults: false,
      isDragging: false,
      startX: 0,
      startY: 0,
      currentX: 0,
      currentY: 0
    };

    const calculatePoliticalProfile = () => {
      if (!resultadosConfig || Object.keys(resultadosConfig).length === 0) {
        return null;
      }
      
      const columnaA = resultadosConfig.columnas?.columna_a || [];
      const columnaB = resultadosConfig.columnas?.columna_b || [];
      const perfiles = resultadosConfig.perfiles || [];
      
      let puntosA = 0;
      let puntosB = 0;
      
      // Contar respuestas en cada columna
      Object.values(state.choices).forEach(choice => {
        if (columnaA.includes(choice)) {
          puntosA++;
        } else if (columnaB.includes(choice)) {
          puntosB++;
        }
      });
      
      // Determinar perfil
      let perfilSeleccionado = null;
      
      // Verificar cada perfil
      for (const perfil of perfiles) {
        const condicion = perfil.condicion.toLowerCase();
        
        if (condicion.includes("columna b") && puntosB > puntosA) {
          perfilSeleccionado = perfil;
          break;
        } else if (condicion.includes("columna a") && puntosA > puntosB) {
          perfilSeleccionado = perfil;
          break;
        } else if (condicion.includes("mezcla") && Math.abs(puntosA - puntosB) <= 2) {
          perfilSeleccionado = perfil;
          break;
        }
      }
      
      // Si no se encontr√≥ perfil espec√≠fico, usar el primero
      if (!perfilSeleccionado && perfiles.length > 0) {
        perfilSeleccionado = perfiles[0];
      }
      
      return {
        perfil: perfilSeleccionado,
        puntosA,
        puntosB,
        total: dilemmas.length
      };
    };

    const init = () => {
      if (!dilemmas || dilemmas.length === 0) {
        renderError();
        return;
      }
      render();
      window.addEventListener('keydown', handleKeyPress);
    };

    const handleKeyPress = (e) => {
      if (state.isAnimating || state.showResults || state.currentIndex >= dilemmas.length) return;
      if (e.key === 'ArrowLeft') executeSwipe('left');
      if (e.key === 'ArrowRight') executeSwipe('right');
    };

    const executeSwipe = (direction) => {
      if (state.isAnimating || state.currentIndex >= dilemmas.length) return;

      const currentDilemma = dilemmas[state.currentIndex];
      const chosenOption = direction === 'left' 
        ? currentDilemma.options[0].ref_valor 
        : currentDilemma.options[1].ref_valor;

      state.choices[currentDilemma.scene_id] = chosenOption;
      state.isAnimating = true;

      const card = document.querySelector('[data-card-active]');
      const container = document.querySelector('[data-bg-container]');
      
      if (card) {
        const targetX = direction === 'left' ? -1200 : 1200;
        const rotation = direction === 'left' ? -45 : 45;
        
        card.style.transition = `all ${CONFIG.ANIMATION_DURATION}ms cubic-bezier(0.68, -0.55, 0.265, 1.55)`;
        card.style.transform = `translateX(${targetX}px) translateY(-100px) rotate(${rotation}deg) scale(0.8)`;
        card.style.opacity = '0';
      }

      if (container) {
        container.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
      }

      setTimeout(() => {
        state.currentIndex++;
        state.isAnimating = false;

        if (state.currentIndex >= dilemmas.length) {
          state.showResults = true;
          renderResults();
        } else {
          render();
        }
      }, CONFIG.ANIMATION_DURATION);
    };

    const handleDragStart = (clientX, clientY) => {
      if (state.isAnimating) return;
      state.isDragging = true;
      state.startX = clientX;
      state.startY = clientY;
      state.currentX = clientX;
      state.currentY = clientY;

      const card = document.querySelector('[data-card-active]');
      if (card) {
        card.style.transition = 'none';
      }
    };

    const handleDragMove = (clientX, clientY) => {
      if (!state.isDragging || state.isAnimating) return;

      state.currentX = clientX;
      state.currentY = clientY;

      const deltaX = clientX - state.startX;
      const deltaY = clientY - state.startY;
      const rotation = deltaX * CONFIG.ROTATION_FACTOR;
      const progress = Math.min(Math.abs(deltaX) / CONFIG.SWIPE_THRESHOLD, 1);

      const card = document.querySelector('[data-card-active]');
      const badgeLeft = document.querySelector('[data-badge-left]');
      const badgeRight = document.querySelector('[data-badge-right]');
      const container = document.querySelector('[data-bg-container]');

      if (card) {
        card.style.transform = `translate(${deltaX}px, ${deltaY}px) rotate(${rotation}deg)`;
      }

      if (deltaX < 0) {
        if (badgeLeft) badgeLeft.style.opacity = String(progress);
        if (badgeRight) badgeRight.style.opacity = '0';
        if (container) {
          container.style.background = `linear-gradient(135deg, 
            rgba(255, 107, 107, ${0.3 + progress * 0.7}) 0%, 
            rgba(238, 82, 83, ${0.3 + progress * 0.7}) 100%)`;
        }
      } else if (deltaX > 0) {
        if (badgeRight) badgeRight.style.opacity = String(progress);
        if (badgeLeft) badgeLeft.style.opacity = '0';
        if (container) {
          container.style.background = `linear-gradient(135deg, 
            rgba(78, 205, 196, ${0.3 + progress * 0.7}) 0%, 
            rgba(29, 209, 161, ${0.3 + progress * 0.7}) 100%)`;
        }
      } else {
        if (badgeLeft) badgeLeft.style.opacity = '0';
        if (badgeRight) badgeRight.style.opacity = '0';
        if (container) {
          container.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
        }
      }
    };

    const handleDragEnd = () => {
      if (!state.isDragging || state.isAnimating) return;
      state.isDragging = false;

      const deltaX = state.currentX - state.startX;
      const card = document.querySelector('[data-card-active]');
      const container = document.querySelector('[data-bg-container]');

      if (Math.abs(deltaX) > CONFIG.SWIPE_THRESHOLD) {
        executeSwipe(deltaX > 0 ? 'right' : 'left');
      } else {
        if (card) {
          card.style.transition = 'all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
          card.style.transform = 'translate(0, 0) rotate(0deg)';
        }

        const badgeLeft = document.querySelector('[data-badge-left]');
        const badgeRight = document.querySelector('[data-badge-right]');
        if (badgeLeft) badgeLeft.style.opacity = '0';
        if (badgeRight) badgeRight.style.opacity = '0';
        if (container) {
          container.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
        }
      }
    };

    const attachCardEvents = () => {
      const card = document.querySelector('[data-card-active]');
      if (!card) return;

      const onMouseDown = (e) => handleDragStart(e.clientX, e.clientY);
      const onMouseMove = (e) => handleDragMove(e.clientX, e.clientY);
      const onMouseUp = () => handleDragEnd();

      const onTouchStart = (e) => {
        const touch = e.touches[0];
        handleDragStart(touch.clientX, touch.clientY);
      };
      const onTouchMove = (e) => {
        e.preventDefault();
        const touch = e.touches[0];
        handleDragMove(touch.clientX, touch.clientY);
      };
      const onTouchEnd = () => handleDragEnd();

      card.addEventListener('mousedown', onMouseDown);
      document.addEventListener('mousemove', onMouseMove);
      document.addEventListener('mouseup', onMouseUp);

      card.addEventListener('touchstart', onTouchStart, { passive: true });
      card.addEventListener('touchmove', onTouchMove, { passive: false });
      card.addEventListener('touchend', onTouchEnd);
    };

    const createCard = (dilemma, isActive = false) => {
      if (!dilemma) return '';
      
      const zIndex = isActive ? 10 : 5;
      const transform = isActive ? 'translate(0, 0) scale(1)' : 'translate(0, 10px) scale(0.95)';
      const opacity = isActive ? '1' : '0.7';

      return `
        <div 
          ${isActive ? 'data-card-active' : ''}
          style="
            position: absolute;
            width: 100%;
            height: 100%;
            background: white;
            border-radius: clamp(16px, 4vw, 24px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            cursor: ${isActive ? 'grab' : 'default'};
            user-select: none;
            touch-action: none;
            z-index: ${zIndex};
            transform: ${transform};
            opacity: ${opacity};
            transition: transform 0.3s ease, opacity 0.3s ease;
          "
        >
          <div style="
            width: 100%;
            height: 60%;
            position: relative;
            overflow: hidden;
            background: #f0f0f0;
          ">
            <img 
              src="${dilemma.image_url}" 
              alt="${dilemma.title}"
              style="
                width: 100%;
                height: 100%;
                object-fit: cover;
                pointer-events: none;
                user-select: none;
              "
              draggable="false"
            />
            <div style="
              position: absolute;
              bottom: 0;
              left: 0;
              right: 0;
              height: 50%;
              background: linear-gradient(to top, rgba(0, 0, 0, 0.6), transparent);
            "></div>
          </div>

          <div style="
            height: 40%;
            padding: clamp(1rem, 4vw, 1.5rem);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
          ">
            <div>
              <h2 style="
                margin: 0 0 0.5rem 0;
                font-size: clamp(1.25rem, 4vw, 1.75rem);
                font-weight: 700;
                color: #2d3436;
                line-height: 1.2;
              ">${dilemma.title}</h2>
              <p style="
                margin: 0;
                font-size: clamp(0.875rem, 3vw, 1rem);
                color: #636e72;
                line-height: 1.4;
              ">${dilemma.comment}</p>
            </div>

            <div style="
              display: flex;
              align-items: center;
              justify-content: space-between;
              gap: 0.5rem;
              margin-top: 0.5rem;
            ">
              <div style="
                flex: 1;
                background: linear-gradient(135deg, #ffe5e5, #ffd0d0);
                padding: clamp(0.5rem, 2vw, 0.75rem);
                border-radius: 12px;
                text-align: center;
              ">
                <span style="
                  font-size: clamp(0.75rem, 2.5vw, 0.875rem);
                  font-weight: 600;
                  color: #ff6b6b;
                ">${dilemma.options[0].label}</span>
              </div>
              
              <span style="
                font-size: clamp(0.75rem, 2vw, 0.875rem);
                font-weight: 700;
                color: #b2bec3;
              ">VS</span>
              
              <div style="
                flex: 1;
                background: linear-gradient(135deg, #e5f9f7, #d0f4ee);
                padding: clamp(0.5rem, 2vw, 0.75rem);
                border-radius: 12px;
                text-align: center;
              ">
                <span style="
                  font-size: clamp(0.75rem, 2.5vw, 0.875rem);
                  font-weight: 600;
                  color: #4ecdc4;
                ">${dilemma.options[1].label}</span>
              </div>
            </div>
          </div>

          ${isActive ? `
            <div data-badge-left style="
              position: absolute;
              top: clamp(30px, 8vw, 50px);
              right: clamp(15px, 4vw, 30px);
              border: 4px solid #ff6b6b;
              color: #ff6b6b;
              background: rgba(255, 255, 255, 0.95);
              padding: clamp(0.5rem, 2vw, 0.75rem) clamp(1rem, 3vw, 1.5rem);
              border-radius: 10px;
              font-weight: 900;
              font-size: clamp(1.25rem, 5vw, 2rem);
              transform: rotate(15deg);
              opacity: 0;
              pointer-events: none;
              transition: opacity 0.2s ease;
              text-transform: uppercase;
              letter-spacing: 2px;
            ">NO</div>
            <div data-badge-right style="
              position: absolute;
              top: clamp(30px, 8vw, 50px);
              left: clamp(15px, 4vw, 30px);
              border: 4px solid #4ecdc4;
              color: #4ecdc4;
              background: rgba(255, 255, 255, 0.95);
              padding: clamp(0.5rem, 2vw, 0.75rem) clamp(1rem, 3vw, 1.5rem);
              border-radius: 10px;
              font-weight: 900;
              font-size: clamp(1.25rem, 5vw, 2rem);
              transform: rotate(-15deg);
              opacity: 0;
              pointer-events: none;
              transition: opacity 0.2s ease;
              text-transform: uppercase;
              letter-spacing: 2px;
            ">S√ç</div>
          ` : ''}
        </div>
      `;
    };

    const render = () => {
      const root = document.querySelector('[data-tinder-root]');
      if (!root) {
        console.error('No se encontr√≥ el elemento root');
        return;
      }

      const currentDilemma = dilemmas[state.currentIndex];
      const nextDilemma = dilemmas[state.currentIndex + 1];
      const progress = ((state.currentIndex + 1) / dilemmas.length) * 100;

      if (!currentDilemma) {
        console.error('No hay dilemma actual');
        return;
      }

      root.innerHTML = `
        <div data-bg-container style="
          position: fixed;
          inset: 0;
          display: flex;
          flex-direction: column;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          transition: background 0.4s ease;
          overflow: hidden;
        ">
          
          <header style="
            padding: clamp(1rem, 4vw, 2rem) clamp(1rem, 4vw, 1.5rem);
            text-align: center;
            color: white;
            flex-shrink: 0;
          ">
            <h1 style="
              margin: 0 0 clamp(0.75rem, 3vw, 1rem) 0;
              font-size: clamp(1.5rem, 5vw, 2rem);
              font-weight: 900;
              text-transform: uppercase;
              letter-spacing: clamp(1px, 0.5vw, 3px);
            ">${title}</h1>
            <p style="
              margin: 0 0 clamp(0.75rem, 3vw, 1rem) 0;
              font-size: clamp(0.875rem, 3vw, 1rem);
              opacity: 0.9;
              font-weight: 500;
            ">${description}</p>
            
            <div style="
              position: relative;
              width: min(200px, 80%);
              height: 6px;
              background: rgba(255, 255, 255, 0.2);
              margin: 0 auto;
              border-radius: 10px;
              overflow: hidden;
            ">
              <div style="
                position: absolute;
                top: 0;
                left: 0;
                height: 100%;
                width: ${progress}%;
                background: linear-gradient(90deg, #00ff88, #00d9ff);
                border-radius: 10px;
                transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
              "></div>
            </div>
            
            <p style="
              margin: clamp(0.5rem, 2vw, 0.75rem) 0 0 0;
              font-size: clamp(0.875rem, 3vw, 1rem);
              opacity: 0.9;
              font-weight: 500;
            ">${state.currentIndex + 1} / ${dilemmas.length}</p>
          </header>

          <div style="
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: clamp(0.5rem, 2vw, 1rem);
            min-height: 0;
          ">
            <div style="
              position: relative;
              width: 100%;
              max-width: min(450px, 100%);
              aspect-ratio: 3 / 4;
              max-height: min(600px, 70vh);
            ">
              ${nextDilemma ? createCard(nextDilemma, false) : ''}
              ${createCard(currentDilemma, true)}
            </div>
          </div>

          <footer style="
            padding: clamp(1rem, 4vw, 2rem);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: clamp(1.5rem, 5vw, 3rem);
            flex-shrink: 0;
          ">
            <button data-btn-left style="
              width: clamp(60px, 15vw, 80px);
              height: clamp(60px, 15vw, 80px);
              border-radius: 50%;
              border: none;
              background: white;
              color: #ff6b6b;
              font-size: clamp(1.5rem, 5vw, 2rem);
              cursor: pointer;
              box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
              transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
              display: flex;
              align-items: center;
              justify-content: center;
              font-weight: bold;
            ">‚úï</button>
            
            <button data-btn-right style="
              width: clamp(60px, 15vw, 80px);
              height: clamp(60px, 15vw, 80px);
              border-radius: 50%;
              border: none;
              background: white;
              color: #4ecdc4;
              font-size: clamp(1.5rem, 5vw, 2rem);
              cursor: pointer;
              box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
              transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
              display: flex;
              align-items: center;
              justify-content: center;
              font-weight: bold;
            ">‚ù§</button>
          </footer>
        </div>
      `;

      attachCardEvents();
      attachButtonEvents();
    };

    const attachButtonEvents = () => {
      const btnLeft = document.querySelector('[data-btn-left]');
      const btnRight = document.querySelector('[data-btn-right]');

      const addButtonEffects = (btn) => {
        btn.addEventListener('mousedown', () => {
          btn.style.transform = 'scale(0.85)';
        });
        btn.addEventListener('mouseup', () => {
          btn.style.transform = 'scale(1)';
        });
        btn.addEventListener('mouseleave', () => {
          btn.style.transform = 'scale(1)';
        });
        btn.addEventListener('mouseenter', () => {
          btn.style.transform = 'scale(1.1)';
        });
      };

      if (btnLeft) {
        btnLeft.addEventListener('click', () => executeSwipe('left'));
        addButtonEffects(btnLeft);
      }

      if (btnRight) {
        btnRight.addEventListener('click', () => executeSwipe('right'));
        addButtonEffects(btnRight);
      }
    };

    const renderResults = () => {
      const politicalProfile = calculatePoliticalProfile();
      const root = document.querySelector('[data-tinder-root]');
      if (!root) return;

      // Crear lista de resultados
      const resultsHTML = dilemmas.map((dilemma, index) => {
        const choice = state.choices[dilemma.scene_id];
        const chosenOption = dilemma.options.find(opt => opt.ref_valor === choice);
        const label = chosenOption ? chosenOption.label : 'N/A';
        
        // Determinar columna
        const columnaA = resultadosConfig.columnas?.columna_a || [];
        const columnaB = resultadosConfig.columnas?.columna_b || [];
        const isColumnaA = columnaA.includes(choice);
        const isColumnaB = columnaB.includes(choice);
        const columna = isColumnaA ? 'A' : (isColumnaB ? 'B' : '');

        return `
          <article data-result-item="${index}" style="
            background: white;
            border-radius: clamp(12px, 3vw, 16px);
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: fadeInUp 0.5s ease backwards;
            animation-delay: ${index * 0.05}s;
            display: flex;
            flex-direction: column;
            height: 100%;
          ">
            
            <div style="
              width: 100%;
              height: clamp(140px, 35vw, 180px);
              position: relative;
              overflow: hidden;
              background: linear-gradient(135deg, #f0f0f0, #e0e0e0);
            ">
              <img 
                src="${dilemma.image_url}" 
                alt="${dilemma.title}"
                loading="lazy"
                style="
                  width: 100%;
                  height: 100%;
                  object-fit: cover;
                "
              />
              <div style="
                position: absolute;
                top: clamp(8px, 2vw, 12px);
                right: clamp(8px, 2vw, 12px);
                background: ${isColumnaA ? 'linear-gradient(135deg, #4ecdc4, #1dd1a1)' : 'linear-gradient(135deg, #ff6b6b, #ee5253)'};
                color: white;
                padding: clamp(4px, 1.5vw, 6px) clamp(10px, 3vw, 14px);
                border-radius: 20px;
                font-size: clamp(0.7rem, 2.5vw, 0.85rem);
                font-weight: 700;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
              ">${columna}</div>
            </div>

            <div style="
              padding: clamp(1rem, 4vw, 1.5rem);
              flex: 1;
              display: flex;
              flex-direction: column;
              gap: clamp(0.5rem, 2vw, 0.75rem);
            ">
              <div>
                <h3 style="
                  margin: 0 0 clamp(0.25rem, 1vw, 0.5rem) 0;
                  font-size: clamp(1rem, 4vw, 1.25rem);
                  font-weight: 700;
                  color: #2d3436;
                  line-height: 1.3;
                ">${dilemma.title}</h3>
                <p style="
                  margin: 0;
                  font-size: clamp(0.8rem, 3vw, 0.9rem);
                  color: #636e72;
                  line-height: 1.5;
                ">${dilemma.comment}</p>
              </div>

              <div style="margin-top: auto;">
                <div style="
                  display: flex;
                  align-items: center;
                  gap: clamp(0.5rem, 2vw, 0.75rem);
                  padding: clamp(0.75rem, 3vw, 1rem);
                  background: linear-gradient(135deg, #f8f9fa, #e9ecef);
                  border-radius: 12px;
                  border-left: 4px solid ${isColumnaA ? '#4ecdc4' : '#ff6b6b'};
                ">
                  <div style="
                    flex-shrink: 0;
                    width: clamp(32px, 10vw, 40px);
                    height: clamp(32px, 10vw, 40px);
                    background: ${isColumnaA ? 'linear-gradient(135deg, #4ecdc4, #1dd1a1)' : 'linear-gradient(135deg, #ff6b6b, #ee5253)'};
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-size: clamp(1rem, 4vw, 1.25rem);
                    font-weight: bold;
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                  ">${columna}</div>
                  <div style="flex: 1; min-width: 0;">
                    <div style="
                      font-size: clamp(0.7rem, 2.5vw, 0.8rem);
                      font-weight: 600;
                      color: #636e72;
                      margin-bottom: 2px;
                    ">Tu elecci√≥n</div>
                    <div style="
                      font-size: clamp(0.9rem, 3.5vw, 1.1rem);
                      font-weight: 700;
                      color: #2d3436;
                    ">${label}</div>
                  </div>
                </div>
              </div>
            </div>
          </article>
        `;
      }).join('');

      // Secci√≥n de perfil pol√≠tico
      const profileSection = politicalProfile && politicalProfile.perfil ? `
        <div style="
          background: white;
          border-radius: clamp(16px, 4vw, 20px);
          padding: clamp(1.5rem, 4vw, 2.5rem);
          margin-bottom: clamp(1.5rem, 4vw, 2rem);
          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
          border: 1px solid rgba(0, 0, 0, 0.05);
        ">
          <div style="text-align: center; margin-bottom: clamp(1.5rem, 4vw, 2rem);">
            <div style="
              font-size: clamp(2rem, 8vw, 3.5rem);
              margin-bottom: clamp(0.5rem, 2vw, 1rem);
            ">üéØ</div>
            <h2 style="
              margin: 0 0 clamp(0.5rem, 2vw, 0.75rem) 0;
              color: #2d3436;
              font-size: clamp(1.5rem, 5vw, 2rem);
              font-weight: 900;
            ">Tu Perfil Pol√≠tico</h2>
          </div>

          <div style="
            background: linear-gradient(135deg, #667eea15, #764ba215);
            border-radius: clamp(12px, 3vw, 16px);
            padding: clamp(1.5rem, 4vw, 2rem);
            margin-bottom: clamp(1.5rem, 4vw, 2rem);
            border: 2px solid #667eea30;
          ">
            <div style="
              font-size: clamp(1.25rem, 4vw, 1.75rem);
              font-weight: 900;
              color: #2d3436;
              margin-bottom: clamp(0.75rem, 3vw, 1rem);
              text-align: center;
            ">${politicalProfile.perfil.nombre}</div>
            
            <div style="
              display: flex;
              align-items: center;
              justify-content: center;
              gap: clamp(1rem, 3vw, 2rem);
              margin-bottom: clamp(1rem, 3vw, 1.5rem);
              flex-wrap: wrap;
            ">
              <div style="text-align: center;">
                <div style="
                  font-size: clamp(2rem, 6vw, 3rem);
                  font-weight: 900;
                  color: #4ecdc4;
                  line-height: 1;
                ">${politicalProfile.puntosA}</div>
                <div style="
                  font-size: clamp(0.8rem, 2.5vw, 0.9rem);
                  color: #636e72;
                  font-weight: 600;
                ">Columna A</div>
              </div>
              
              <div style="
                width: 1px;
                height: 40px;
                background: rgba(0, 0, 0, 0.1);
              "></div>
              
              <div style="text-align: center;">
                <div style="
                  font-size: clamp(2rem, 6vw, 3rem);
                  font-weight: 900;
                  color: #ff6b6b;
                  line-height: 1;
                ">${politicalProfile.puntosB}</div>
                <div style="
                  font-size: clamp(0.8rem, 2.5vw, 0.9rem);
                  color: #636e72;
                  font-weight: 600;
                ">Columna B</div>
              </div>
            </div>
            
            <p style="
              margin: 0;
              color: #636e72;
              font-size: clamp(0.9rem, 3vw, 1.1rem);
              line-height: 1.6;
              text-align: center;
            ">${politicalProfile.perfil.descripcion}</p>
          </div>
        </div>
      ` : '<p style="text-align: center; color: #636e72; padding: 2rem;">No se pudo calcular el perfil pol√≠tico</p>';

      root.innerHTML = `
        <div style="
          position: fixed;
          inset: 0;
          display: flex;
          flex-direction: column;
          background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
          overflow: hidden;
        ">
          
          <header style="
            padding: clamp(1.5rem, 4vw, 2.5rem) clamp(1rem, 4vw, 2rem) clamp(1rem, 3vw, 1.5rem);
            text-align: center;
            background: white;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            flex-shrink: 0;
            z-index: 10;
          ">
            <h2 style="
              margin: 0 0 clamp(0.5rem, 2vw, 0.75rem) 0;
              color: #2d3436;
              font-size: clamp(1.75rem, 6vw, 2.5rem);
              font-weight: 900;
            ">üìã Tus Decisiones</h2>
            <p style="
              margin: 0;
              color: #636e72;
              font-size: clamp(0.9rem, 3vw, 1.1rem);
              font-weight: 500;
            ">Completaste ${dilemmas.length} dilemas futbol√≠sticos</p>
          </header>

          <div data-results-scroll style="
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
          ">
            <div style="
              padding: clamp(1rem, 4vw, 2rem);
              max-width: 1200px;
              margin: 0 auto;
            ">
              ${profileSection}
              
              <h3 style="
                margin: 0 0 clamp(1rem, 3vw, 1.5rem) 0;
                color: #2d3436;
                font-size: clamp(1.25rem, 4vw, 1.75rem);
                font-weight: 700;
              ">Detalle de tus decisiones:</h3>
              
              <div style="
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(min(320px, 100%), 1fr));
                gap: clamp(1rem, 3vw, 1.5rem);
                margin-bottom: clamp(1.5rem, 4vw, 2rem);
              ">
                ${resultsHTML}
              </div>
            </div>
          </div>

          <footer style="
            padding: clamp(1rem, 4vw, 1.5rem);
            text-align: center;
            background: white;
            border-top: 1px solid rgba(0, 0, 0, 0.08);
            flex-shrink: 0;
            box-shadow: 0 -2px 12px rgba(0, 0, 0, 0.05);
          ">
            <button data-btn-reset style="
              padding: clamp(0.875rem, 3vw, 1.25rem) clamp(2rem, 6vw, 3.5rem);
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
              border: none;
              border-radius: 50px;
              font-size: clamp(0.9rem, 3.5vw, 1.125rem);
              font-weight: 700;
              cursor: pointer;
              box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
              transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
              display: inline-flex;
              align-items: center;
              gap: clamp(0.5rem, 2vw, 0.75rem);
            ">
              <span style="font-size: clamp(1.2rem, 4vw, 1.5rem);">üîÑ</span>
              <span>Jugar de Nuevo</span>
            </button>
          </footer>
        </div>
      `;

      const resetBtn = document.querySelector('[data-btn-reset]');
      if (resetBtn) {
        resetBtn.addEventListener('click', () => {
          state = {
            currentIndex: 0,
            choices: {},
            isAnimating: false,
            showResults: false,
            isDragging: false,
            startX: 0,
            startY: 0,
            currentX: 0,
            currentY: 0
          };
          render();
        });
      }
    };

    const renderError = () => {
      const root = document.querySelector('[data-tinder-root]');
      if (!root) return;

      root.innerHTML = `
        <div style="
          display: flex;
          align-items: center;
          justify-content: center;
          min-height: 100vh;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          padding: 2rem;
          text-align: center;
        ">
          <div>
            <div style="
              font-size: clamp(3rem, 10vw, 5rem);
              margin-bottom: 1rem;
            ">‚ö†Ô∏è</div>
            <h1 style="
              color: white;
              font-size: clamp(1.5rem, 5vw, 2.5rem);
              margin: 0 0 1rem 0;
              font-weight: 900;
            ">Error al Cargar</h1>
            <p style="
              color: rgba(255, 255, 255, 0.9);
              font-size: clamp(1rem, 3vw, 1.25rem);
              margin: 0 0 2rem 0;
              max-width: 400px;
            ">No se pudieron cargar los datos del juego. Por favor, intenta nuevamente.</p>
            <button onclick="window.location.reload()" style="
              padding: 1rem 2.5rem;
              background: white;
              color: #667eea;
              border: none;
              border-radius: 50px;
              font-weight: 700;
              font-size: 1rem;
              cursor: pointer;
              box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            ">
              üîÑ Recargar P√°gina
            </button>
          </div>
        </div>
      `;
    };

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  })();
</script>

<style>
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  [data-tinder-root] {
    position: fixed;
    inset: 0;
    overflow: hidden;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
  }

  * {
    -webkit-tap-highlight-color: transparent;
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  button {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    font-family: inherit;
  }

  img {
    -webkit-user-drag: none;
    -khtml-user-drag: none;
    -moz-user-drag: none;
    -o-user-drag: none;
    user-drag: none;
  }

  /* Scrollbar personalizado */
  [data-results-scroll]::-webkit-scrollbar {
    width: 8px;
  }

  [data-results-scroll]::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.05);
  }

  [data-results-scroll]::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-radius: 10px;
  }

  [data-results-scroll]::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, #764ba2, #667eea);
  }

  /* Smooth scroll para Firefox */
  [data-results-scroll] {
    scrollbar-width: thin;
    scrollbar-color: #667eea rgba(0, 0, 0, 0.05);
  }

  /* Optimizaci√≥n de performance */
  [data-card-active] {
    will-change: transform, opacity;
  }

  [data-result-item] {
    will-change: transform;
  }

  /* Media queries */
  @media (max-width: 640px) {
    [data-results-scroll] > div > div > div {
      grid-template-columns: 1fr;
    }
  }

  @media (min-width: 641px) and (max-width: 1024px) {
    [data-results-scroll] > div > div > div {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 1025px) {
    [data-results-scroll] > div > div > div {
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    }
  }

  /* Reducir animaciones */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
</style>